import{j as e,F as A,r as l,A as v,C as R,c as r,S as j,t as H,E as S,I,f as _,G as M,v as O,u as P,z as $,P as V,T,H as U,m as J}from"./vendor.e4257099.js";import{i as z,I as C,f as X}from"./index.8152c4b7.js";const D=({text:a,highlight:c})=>{if(!c)return e(A,{children:a});const t=a.split(new RegExp(`(${c})`,"gi"));return e("span",{children:t.map((o,p)=>e("span",{className:o.toLowerCase()===c.toLowerCase()?"highlight":"",children:o},p))})};window.HELP_IMPROVE_VIDEOJS=!1;const g={},G=a=>{var x,N,w,F;const c=l.exports.useRef(null),t=l.exports.useRef(null),[o,p]=l.exports.useState(!1),[u,m]=l.exports.useState(""),y=l.exports.useCallback(async()=>{if(a.replay&&!g[a.replay.id]){p(!0);const{id:s,roomId:i,startAt:d,endAt:h}=a.replay,b=await z({roomId:i,startTime:d,endTime:h||v(d).add(3,"hour").toJSON()});g[s]=b,p(!1)}},[(x=a.replay)==null?void 0:x.id]);l.exports.useEffect(()=>{y()},[y]);const f=l.exports.useCallback(()=>{var i,d;if(!((i=a.replay)!=null&&i.choseUrl))return;const s={playbackRates:[.7,1,1.5,2],responsive:!0,plugins:{hotkeys:{volumeStep:.1,seekStep:15,enableModifiersForNumbers:!1}}};if(t.current)t.current.src((d=a.replay)==null?void 0:d.choseUrl),t.current.options(s);else if(c.current){const h=window.videojs(c.current,s,function(){});t.current=h}},[(N=a.replay)==null?void 0:N.choseUrl,c.current]);l.exports.useEffect(()=>{f()},[f]);const E=l.exports.useCallback(()=>{const s=t.current;s&&s.reset()},[t.current]);l.exports.useEffect(()=>()=>{E()},[t]);const k=s=>{var i,d;if(((i=a.replay)==null?void 0:i.startAt)&&t.current){const h=v(s).diff(v((d=a.replay)==null?void 0:d.startAt),"second");t.current.currentTime(h)}},n=g[((w=a.replay)==null?void 0:w.id)||""],B=R(s=>{const i=s.target.value.trim();m(i)},300),L=()=>u?M(n==null?void 0:n.roomActionList,s=>{var i;return((i=s.userName)==null?void 0:i.toLowerCase().includes(u))||s.description.replace(/(TEXT:|CODE:)/,"").toLowerCase().includes(u)}):n==null?void 0:n.roomActionList;return r("div",{className:"video-replay-wrap",children:[e("div",{className:"replay-box",children:e("div",{"data-vjs-player":!0,style:{width:"100%",height:"100%"},children:r("video",{controls:!0,playsInline:!0,ref:c,id:"replay-video",className:"video-js vjs-big-play-centered",preload:"auto",children:[e("source",{src:(F=a.replay)==null?void 0:F.choseUrl,type:"video/mp4"}),r("p",{className:"vjs-no-js",children:["To view this video please enable JavaScript, and consider upgrading to a web browser that",e("a",{href:"https://videojs.com/html5-video-support/",target:"_blank",children:"supports HTML5 video"})]})]})})}),r("div",{className:"replay-chat-history",children:[r("header",{children:[e("h3",{children:"\u804A\u5929\u8BB0\u5F55 "}),(n==null?void 0:n.totalNum)&&r("span",{className:"chat-total",children:["\u5171",e("span",{children:n==null?void 0:n.totalNum}),"\u6761"]})]}),e("main",{className:`${o?"chat-loading":""}`,children:o?e(j,{spinning:o}):H(n==null?void 0:n.roomActionList)?e(S,{description:"\u6682\u65E0\u6570\u636E"}):r(A,{children:[e(I,{allowClear:!0,className:"chat-text-search",width:"100%",placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5173\u952E\u5B57!",suffix:e(C,{symbol:"icon-search"}),onChange:B,onPressEnter:s=>{const i=s.currentTarget.value.trim();m(i)}}),_(L(),s=>r("div",{className:"chat-item",children:[r("span",{className:"chator",children:[e(D,{text:s.userName,highlight:u}),e("span",{className:"chat-time",children:v(s.actionTime).format("HH:mm:ss")})]}),e("pre",{onClick:()=>k(s.actionTime),children:e(D,{text:s.description.replace(/(TEXT:|CODE:)/,""),highlight:u})})]},s.id))]})})]})]})};const Q=()=>{const{id:a,replayId:c}=O(),[t,o]=l.exports.useState(),p=P(),u=l.exports.useCallback(async()=>{const y=await X(a),f=$(y,({id:E})=>`${E}`===c);o(f)},[a]);l.exports.useEffect(()=>{u()},[u]);const m=l.exports.useMemo(()=>e("div",{className:"video-hotkeys-help",children:r("ul",{children:[r("li",{children:[e("span",{children:"space"})," \u63A7\u5236",e("span",{children:"\u6682\u505C/\u64AD\u653E"})]}),r("li",{children:[e("span",{children:"\u2190/\u2192"})," \u63A7\u5236",e("span",{children:"\u540E\u9000/\u524D\u8FDB(15\u79D2)\u89C6\u9891"})]}),r("li",{children:[e("span",{children:"\u2191/\u2193"})," \u63A7\u5236",e("span",{children:"\u653E\u5927/\u7F29\u5C0F\u97F3\u91CF"})]}),r("li",{children:[e("span",{children:"m"})," \u89E6\u53D1",e("span",{children:"\u9759\u97F3"})]}),r("li",{children:[e("span",{children:"f/\u53CC\u51FB"})," \u89E6\u53D1",e("span",{children:"\u5168\u5C4F"})]}),r("li",{children:[e("span",{children:"\u6570\u5B570-9"})," \u8DF3\u8F6C\u89C6\u9891\u767E\u5206\u6BD4",e("span",{children:"0 is 0% and 9 is 90%"})]})]})}),[]);return r("div",{className:"video-replay-modal",children:[r("header",{children:[e("div",{className:"title",children:t==null?void 0:t.className}),r("div",{className:"actions",children:[e(V,{content:m,title:"\u64AD\u653E\u5668\u5FEB\u6377\u952E",trigger:"click",placement:"leftTop",children:e(C,{symbol:"icon-help",className:"hotkey-help"})}),e(T,{title:"\u590D\u5236\u94FE\u63A5",children:e(U.CopyToClipboard,{text:window.location.href,onCopy:()=>{J.success("\u590D\u5236\u6210\u529F!")},children:e(C,{symbol:"icon-share"})})}),e(T,{title:"\u8FD4\u56DE\u8BFE\u7A0B",children:e(C,{symbol:"icon-fanhui",onClick:()=>p(`/${a}`)})})]})]}),e("div",{className:"video-replay-content",children:e(G,{replay:t})})]})};export{Q as default};
